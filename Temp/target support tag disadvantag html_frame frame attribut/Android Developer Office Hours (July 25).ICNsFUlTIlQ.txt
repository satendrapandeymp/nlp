hello and welcome once again to Android developer office hours my name is Joe Malin on your moderator to my right is Trevor John's beyond him is Jeff Sharkey and Rado Meyer and producers panel is Robert Lee and I can't think of anything else to say at this moment except that our topic for today is performance more importantly its efficiency an efficiency started efficiency okay great thank you very much shout out your questions you can get into the Hangout and call them in or you can type them in or whatever you want to do for the moment since we don't have any of those from the Hangout we're going to go to moderator and take some of the questions that have been entered already the first question is is there a simple way to get distinct results from the contacts provider I use the loader manager degree the cursor loader cursor is passed to an adapter of an autocomplete text field but I get dupes I will try to answer this and if the person that asked this is online I would like to know more about exactly what you're trying to do product my guess is what you based on what you've said you're getting duplicates because there are there are distinct records in the provider for the same person and that's the way the provider is supposed to work you will not the provider is set up so that different versions of the same person from different sources are recorded as distinct records and they're not the duplicates are not eliminated what they're what happens is they're a graduated into a single record that points to all of these different versions yeah so for example you could have you know you're the contact from Google from your Google contact book as well as the data that's retrieved from Google Plus that the user themself inherited right so depending on how you access the provider um you could get a person's record based on their personal Gmail their work Gmail Google+ etc and the documentation for contacts provider that's on developer.android.com explains to you how to deal with that situation and get the sort of data that you maybe looking for and that's probably why you're getting duplicates if you were to look at all the information in the records that are being returned to you you can see that some of it was different yeah so I guess this is clip stay away from the vault contacts table also the David maple is gonna have duplicate data as well but I believe the high-level contacts table should have a single representation of appropriate of each person and that that would be a good starting point if you're trying to be through the docs there's if you look in the documentation you'll see some examples of how to retrieve different types of information from the provider and also look at things called entities and what entities do is come do a sort of behind the scenes combined of different pieces of data that help you do the sorts of things that you might want to do with the provider but I definitely suggest you look at the documentation anything else no I think that pretty much covered it okay next question what are some tips for file manager UI's I'm currently writing an app that although it auto saves it save files an external one should be accessible for edit to the user the file browsers on the store are in lists or icons dpi is also a factor all right so so first thing don't show the raw file system as my my recommendation right you know there's a number of file manager apps out there you know for example astro and the review tools for power users but it's not them although we want for Android UI is we really want to say okay here's the documents on your device we don't really care where they live are they on internal storage external storage in some folder all that's relevant we don't actually want to expose the underlying you know Linux file system we just wanna say again here it's all the docs we could find go ahead and pick one and open it up if you're asking whether I should be a list versus thumbnails versus some sort of icon I tend to lean a little bit more towards the idea of either a list or thumbnails and possibly even allow the user to pick if you have more screen real estate thumbnails are really nice but they do take up more space a good example of if you're looking at something to model off of would be Google Docs they do a really cool Drive excuse me they do a really awesome ListView for displaying files and because they don't have a file hug or a folder hierarchy but by default they have to go and do that really well of course you still can't create folders and they handle that too but that I guess that's my advice it's really more of a UI question and without seeing your app I don't think we can give you one-size-fits-all recommendations here but I think that should be some good general guidance any other comments yeah one thing to think about when you're building a file browser like that you're gonna have the different UI on phones versus tablets so on a phone you might end up with that single list view where the navigate the user navigates deeper into a file hierarchy you might be able to present the the tree or the file system tree on like a left-hand side pane using something like fragments on a tablet sized app so it definitely depends on which size of device you're targeting you might be able to fit more or less less details yeah I think generally you know I just want to reiterate what what Trevor and Joe have already said and that is generally speaking the move has been away from having sort of hierarchical file structures for to support your app I mean it kind of made sense back in sort of the pre GUI days we had to figure out a way to be able to put things in a place you'd be able to find them again if all you've got is the ability to list the files in a in a folder and what the current folder is these days that the move is very much away from that it's really more about tagging things making them more easily searchable and you can see the way that Google Drive does that in it your things just sort of sit there and you can tag them and you can search for them and same with Gmail which was sort of the forerunner for that so in most cases if what you're building is just a file manager then you know I think it's it does have some value if you're figuring out how to put the file manager into your app to make it easy if you use this to save files and load files I'd say that you're probably going in slightly the wrong direction she'd be thinking more about how can you make it easy for people to find the content that they're looking for without having to know a hierarchy in order to do so okay yeah I would add that the difference is that if you use some sort of file hierarchy like old-fashioned directories then you've just kind of stuck with putting one thing in one place whereas if you tagged it or give it some metadata that you can then search on that for you can put off put something so to speak in more than one place at the same time kind of like the way that labels work in Gmail I mean they appear sometimes to be folders but they're really not a message can be in more than one label it can have more than one label at the same time and that's a great benefit to users yep and yeah another thing to think about too we're speeding parkings death here but when you have nested folders or nested directories you have to go and click through all of them and that sort of a pain on a mobile device it's a lot easier if you have a list you swipe you tap you're done and again I layer touched on this search is incredibly important to make sure you have that in there might say it's more important than tagging if you can only implement one of these suggestions so it'll be searched okay okay I don't like all about creating a category side view which takes only half the screen when sufficient real estate is available with a pager title strip similar to what is shown in Google Play okay so the question was can people hear you on the Hangout yeah okay fine so you've heard the question I heard the question but could you repeat it actually sure thing how do I go about creating a category side view which it's only half the screen when sufficient real estate is available with the pager title strips similar to what is shown in google play also yeah I know that in Google Play you can swipe I'm not sure what the side view is that we're trying to pull it up here so we have an example so you go to the top level go into one of the yes I gotta go into Ola yeah I think it'll even work in portrait as well oh cool all right in one of the app so like app so many times yeah we need to hook up our hdmi tablet here so we can actually show you this okay so let me yeah let me just demonstrate turn it around yeah hold up to the camera screen I'm gonna declare when I pull when it stops halfway across then pull it back it's exactly a half way so that's I presume that that's the functionality that they are looking for excellent getting head knots alright that's a good question how would you do that so I would guess that this isn't this isn't using a viewpager oh well at least it's a modified version of you pager yeah I don't think my knowledge there's no way by default to ask for your Pedro do that for you there's another question abut further down on the question q2 which touches on the others which is asking like for example Google+ when you tap the home button you have a navigation panel that slides out from the left and right now there's nothing in the support library or otherwise else when the framework that really makes it easy to do and our recommendation actually right now is really it's an awesome model I love it but it's not something were actually actively recommending the people because there's been so much flux with these widgets everybody's done it a little bit differently so there's not really a single recommended approach as far as our UI guidelines are concerned so if you really do want to implement it right now you're sort of on your own over time once we actually figure out what the you know the right way this should look should be will probably we'll add it somewhere a support library most likely but that's a ways off and that's assuming that we actually said we liked it right this always possible will change our minds later on so yeah pretty much you're on your own unfortunately and there's really and from the technical perspective if you want a good place to start I'd start with viewpager and start modifying that but it's not going to be as simple as just having a at property so it looks so if we try and think it through so it looks like what it's doing is it's a because all of the other interaction works exactly the same as view pager so if you started with that and it looks like all doing a saying if if you're at n plus one well I guess at one then this is you know limit the size of the of the fragment for the zeroth fragment right that would seem to be a place to start so have a look at the viewpager and what you want to do is modify the behavior if the first fragment is visible so that it doesn't fully extend to the full width of the of the screen I think we have any sample code sir nope I'm not a weapon either yeah the person that hang out says they looked into that using a view flipper in combination with animations but they cannot figure out how to limit the size yeah never another beautiful bird great a suggestion they tried what you it so they tried what I suggested to the viewpager and they're gonna find out how to limit the size yeah I think that's going to be the struggle because the the way that the viewpager is designed is to effectively just do the animations between to set frames and so instead of having those two fragments on screen I mean the other possibility that you may want to try is to have the zeroth fragment contain so that what you're actually looking at on that view pager isn't actually the last fragment being half-width it's just that the last fragment looks like the previous fragment and the first fragment joined together if that makes sense so I don't know how you would do the animation but maybe once you get halfway across and then it switches it oh no it's getting a little bit Airy even in my own mind but yeah we we'd be interested to see how you get on but I don't think that there's an easy solution for that at this point unfortunately like Trevor says there's the best chance in terms of getting something relatively straightforward is to wait and see if we or anyone else creates a standardized widget to do something similar to what do you pass on YouTube did okay we've got another question on the Hangout all right I am looking for tools or methods that will help me test my app in extreme conditions for example low memory low disk space high CPU usage and in parentheses that is done by another process okay first up here extreme conditions like are you gonna go and try and like drop it in a volcano or watch it into space take it over to Antarctica space has been done by the way we actually have launched Android phones into space but I am not aware of anything on its volcanoes but seriously though you know a good volcano nearby so yeah some of the things like slow Network in particular their support for in the emulator now low disk space I'm not aware of any really good automated ways to go and test that other than writing a script that goes and dumps a bunch of files onto your SD card I know there are some third-party companies that make some test suites that you go and test some things like you know what happens when the battery gets low so off the top of my head I believe testdroid is one of the ones that can do some of this stuff I don't think it can do everything on your list but it's worth looking into that's by a company called bit bar and so that they offer as a subscription service where you upload your apk to their servers and they run a series of tests on devices you've supplied to them sorry on devices they've supplied for you yeah you'd have to mail them any devices and that's probably your best but if you're looking to try and do a lot of this sort of trying to go and automate a bunch of it yourself using things like ADB to go and actually ADB only gets you so far even like if you're trying to test their battery you'd have to hook up some hardware and you know start modifying the voltage that's a tough one so really really no easy way there other than what the emulator already provides and it does supply some of it so definitely look at that first one of the tool that can potentially be really powerful is the monkey which will which generates a bunch of random events I so touches on the screen keyboard event inputs and it'll push them push your app in all different directions and we use that a lot on the team to help cover bugs and all verbs across the platform so to generate a lot of that noise I mean it'll uncover race conditions a lot of times I in code so the monkey tool is great you can find that it's just a using a to be on the command line similarly I think that if you're trying to simulate these sort of extreme conditions based on what other apps are doing the easiest solution in a lot of cases is going to be to create your own version of those other apps and the extreme conditions are going to be when other apps are misbehaving so you get to have fun and create an app which is really poorly behaved it does everything that we tell you not to do it which chews up memory and causes other apps to effectively swap out and get killed yeah I think we actually I think was it Dan hack born would actually something very similar to that thrown in to analyse for a while my own our own builds had a very very badly misbehaving app installed on them for a bit to go and try and test what happens when when apps misbehave thankfully that doesn't ship but yeah I think that's probably a good approach is you know just write your really bad app and that's you know gonna go and cover a list from the performance side of things what happens when things go wrong it's usually the easiest way to do it you can you can do a lot through simulating things but ultimately it's gonna be you know how does my app behave when another app is using all my bandwidth using all my processor using all my storage is to build that other app and it gives you the control as well because then you can decide how far you want it to go so at what point does my app stop being unresponsive and what steps should I take to try and help the system Oh any other comments nope okay thank you gentlemen now let's move on oops I think I skipped one here I have a fragment which uses a loader it implements the loader callbacks I have set retain instance true for the fragment so that is not destroy across orientation changes however the loader it creates in the oncreate loader gets reset why that's a good question yeah actually I have never seen this behavior before so I'm not sure what the answer is off the top of my head this also I think was when a later question to come into the Q's I think a chance to research it beforehand yeah I actually do not know the answer to this yeah our usual advice if you can go ahead and post a question on Stack Overflow we try and take a look at anything that we can't answer after the show and get an answer for you so just go ahead and drop a a comment on the strong the the G+ post pointing to a stack overflow question and we'll try and get some more detail for you after the show this one in particular said retain incident State on fragments is awesome but generally it's designed to work specifically for fragments which don't have a UI which is a perfectly good place to put a loader so one of the things that I've mentioned is of a word of caution is that if you are using that on a fragrant with UI that may be causing the problem so I need to look into more detail because this is something just vaguely tingling in the back of my mind but generally speaking the server taneous and state property is designed for you eyeless fragments yeah you know that question on the Hangout alright I have a performance question related of databases what are the overhead implications with sequel light and increasing the number of tables hmm that's a good question I'd say yeah adding more tables properly it's not going to hurt you too much what is going to hurt you is joins and at some point just having so many records that takes a while day to write through all of them setting indexes wisely is definitely going to help indexes do increase the cost when you perform a light and it's a trade off next gene you get faster read times I'd say yeah that's pretty much really see most of your performance is 20 joins and trying to iterate through a lot of records or searching on fields that don't have an index that sort of thing adding more adding more tables should be fine so performance impact minimal any other comments all right let's move on in the past I've used an intense service to load data from a breast-- web service but I saw that in the new Google i/o app that async loaders are used extensively is loader currently the recommended way to low remote data when should intense service be used okay so I think this one's a bit of confusion about the way the Google i/o app works so using an async loader to go and pull data from a web service doesn't actually sound a very good idea to me and we actually don't do that in the Google i/o app what we do do is we have a background service in conjunction with a sync adapter which goes and fetches the data from the web service stores is in a local database and then that loader is used to go and fetch the data out of the local database and that's the model we're using it's nice because we don't have to worry about trying to fetch data well the apps running everything's already cached locally and in the background we actually can send a GCM message to the phone ask informing if the schedules changed and then it can go and update or update the conference schedule in the background so that way every time you open the app you have to wait for a couple minutes well that's just the latest schedule data you know you always have the latest data right on your phone they're already stashed so as far as the other half of the question which is should or when shouldn't end service be used and I think in that case say it really quickly it's a matter of convenience what's easier for you in 10 service system than I when there's a service were still running as a service it's justa nearly intense services more my family look quickly because I've actually never used that one myself but I think that's more for one-off jobs you specify a bunch of the you specify your request inside of an attempt or as in this case since we're always going and doing the same thing over and over again we're always fetching these you know these schedule changes there's really you know I think it looks better as just a self-contained background service they don't if you have any comments on when intent service is a better choice yeah actually mean we enjoyed I've actually been out talking about this a little bit over the last couple of weeks I think if you're looking specifically between intent service and async task I think that's generally the sort of question people have is often will come across the async task class first and see it is a really convenient way of being able to do background stuff you want to get off the UI thread to work in Android and it's great and it does all of the marshaling to the UI thread for you which is really really handy but that's kind of a clue as to when it's most appropriate as well so there is some overhead associated with it and what it's really designed for is doing something within your activity which is going to have a direct impact on your UI so if it's something which is allowed to get destroyed as soon as your activity gets closed because remember of course that your async tasks within an activity as soon as you rotate the device they're all going to get killed so it's really stuff which should not be long-lived it's just too time consuming to do on the UI thread in sensors is just a really neat way of being able to encapsulate one of the most common service implementations implementation patterns so service is basically designed there for anything within your app which needs to live longer than the average lifespan of a particular activity instance so anything which needs to live across multiple activities anything which should stay continued to be active when you're rotating the screen all that sort of stuff should live in a service so anything which you're downloading which is more than you know anything non-trivial which of downloading probably wants to be in a service and the intent service is really handy because it creates this queue for you so it'll just basically create a serial queue where you keep sending it commands to do and it will just keep going through them until all the tasks have been done and then neatly kill the service for you so if you're doing things like intermittent download so as as Trevor says anything which is going to be on a regular schedule anything which has to happen you know on an ongoing basis she'd probably lose you know you something like a sync adapter but if you're just going to be downloading things when a user click something so you don't really know when it's going to happen then intent so this is perfect because you just send it the send it the thing say oh I want you to download this you will download it when it's finished it updates your content provider and then your UI automatically gets updated via its loader when the content provider associated with it has been updated so it just helps to create that nice sort of you know pattern for you and often that's kind of the way it works as well as like you intuitively like you when you first get started with something you have an activity you have your UI so there's a temptation to just do everything within that class and it's kind of the trick behind Android is that you're your sort of main form he's actually made up of your activity plus the services that support a plus but potentially a content provider as well so you really need to think of all of those modules and how they fit together in order to create something that works in the best one thank you good answer make all you need to take it beverage to voice in my mouth any other comments so then one of their value of intent service is really I if you're in your UI and you want to persist something if you really want to make sure that it gets saved that's what intent service is there for because even if the user hits the HOME key or gets an incoming phone call um if you've kicked that off in an async task there's the potential that your process gets killed and that data may not be saved so if the data is important send it off to that intent service it's something that's important to persist yeah that's a very good point I would add that it's really great for being able to go send off some work to be done allowing the user then to go off and do any other tasks that may come up so that if a phone call comes in or the user wants to go off and do some work and wait for this thing to finish they can go do that and then get notification or some other indication on when the work is done and then go back to the activity okay let's move another live question shoot is there a way to use a different class loader at development time not necessary for production for services it looks like it's possible to do this for activities using instrumentations a new activity method but I'd like to do this for all parts of an app a different class order okay the only thing that instrumentation does really in terms of loading classes is that it allows you a little bit of extra control or injection into activities and there's instrumentation available for services and for content providers as well as for activities that's the only answer that I can give myself so that I'd be curious to see what the use case is to know what the answer would be yeah I mean I know it definitely is possible to specify a different class loader within your activity when you're circling and firing off other things like creating a new service creating other activities I think you have limited control there but I know that definitely is a way to go and control things once your activity has gotten started so unfortunately it's not a very common task so I can't remember the way to do it off the top of my head but I know it definitely can be done for example I know there was some talk a while back of trying to use this as an investigation mechanism and in classes and do all sorts of other fun things like that again not something I do you recommend most developers try and concern themselves with is lots of pitfalls lie-down that where I would but definitely as possible right yeah that's that's the question oh the activity itself I don't think that's possible I think it's a very the best you can use load classes within the activity because activity startup ISM it is not something that you can control like by the time you have control your activity has already been loaded well except where you get a chance will they need that one before you activities actually created and it will get it maybe slightly before location instance maybe it's worth the try but don't think any of us have ever attempted to do that no it's it like I said lots of lots of dangers when you start messing with the class loader it's usually something I recommend people stay away from also it's a little odd we've been doing a lot of questions today that are text only you guys are welcome to go and hop on video chat or audio just like Robert our producer no and till make sure that you get patched in live to us and we can actually talk to your face-to-face but well what we are more than happy to answer text questions to if you don't have a camera okay we'll move along to the next question in moderator how to create the drop-down slide in navigation from action home up button it is you is it as convoluted as all my Google results indicate or is there a simple way to do it Google Plus YouTube and Spotify incorporate this feature so I think we already answered this one earlier but just to reiterate yes it is as concluded as all your Google results indicate and on that note also we don't recommend really pursuing this until we have a recommendation as part of our our design guide or the very least that people start coming up with some libraries to do it there's really nothing out there that makes it easy yet that said if you've actually like to go and write you know like the first library to implement this I'm sure there's a lots of developers I would thank you but right now it's not something we can really recommend people do unless they're really adventurous as well if anyone does decide to take Trevor up on that on that challenge that so far the consensus so each of these different different implementations you mentioned are slightly different in the way that they work and that's part of what Trevor is talking about is that there isn't a real consensus based on the style guide us to the right way that said the the consensus seems to be heading towards the YouTube model being sort of the the right way of doing that so if you do want to implement something similar look at the way the YouTube app has implemented it and head in that direction but for now it's definitely not for beginners I think it's gonna be a little tricky to do ok has a live video question go for it yeah fire away vodka layup where we have an ad with a button next to it to like launched an in-app purchase but every time we don't give that view the full width of the layout it freaks out and says that it can't display the ad but even if we create a VM that has a you know really tiny screen that is equivalent to what space it has it will display the ad as long as we give it you know like match parent or fill parent and so we're trying to figure out how we can solve this right now what we were thinking about is making a fragment that it was allowed to take the full width up but I'd like to not complicate the layouts too much if possible okay so repeat this and repeat this you you've done an ad that you want to display with a button next to it to do something like in that purchasing correct okay and every time you try to set that up on it complains because it says you don't have enough room to display the ad correct interesting so the ads are coming from a good party provider like AdMob or something like that yes okay interesting so this is only going to be an issue on certain size displays right so if it's if it's a a phone where the the AdMob banner is specified to be the right size to fit basically the full width of the phone then then you're gonna have that issue when you try to put something next to it is that it's alright yeah except for if we create a like a virtual machine that has a width in pixels of what what they you know the vo would be expanded into as long as we don't put the button here works fine so we know that that amount of real estate is sufficient to display the ad that's yeah that's interesting well one we think about that one thing which I would mention is that you need to be really careful when you're trying to create something like what you're describing so one of the requirements we have you know I think it's out developer content policy is that you shouldn't be putting ads anywhere where a user may accidentally click them and so putting ads right next to a button which you want people to press for any reason may actually be in violation of that because it would be very easy to get confused and accidentally hit the ad instead of a button yes they're called fickle I can't remember calling me I can have a look how the Pandora app works like I said I'm not we do the ads behind the interface buttons that doesn't sound awesome um yeah so I can't comment on other apps and and what they may or may not be doing right it's just something which has come up at least once before with a developer I was working with you you ran into some problems on on that basis so I'd be I'd be cautious you you basically want to have any of your in active elements as far away from your ads as possible to avoid running into those kinds of issues okay because I see Keys mentioned something about not being a place ads buttons close to the ads so is that possibly the API is seeing that in causing a problem or that's actually possible I haven't considered that but it is possible that the actual AdMob API is looking and seeing oh you've got a button right next to the ad that's you know not kosher so yeah in it does seem a little strange I'd be a little bit surprised if it was smart enough to do that on your behalf but just from a from UX perspective if nothing else I think it's really not best practice to have your interactive elements is that close to your banner ads right okay so regarding an app purchase button then would that be something like in the overflow of the action bar that what you're buying right it depends on the nature of they not purchase okay so it's an update for your app that adds additional for you all right so yeah the overflow menu is certainly one option the downside there is discoverability right people do the idea behind that workflow menu is you never see it unless you really want to go looking through it a better idea is just to go and put a just so you know when users get to the part of the app where they try and get to the premium features is where you could start promoting the upgrade so have the UI controls available and then when you click on them you could pop up a dialog saying this is reserved for a pool version or you could have an entirely separate screen with all the controls to say a bold and say you know click here to upgrade I'd yeah I probably a better idea just to go and display the dialog as soon as they click on click on the button that takes you to that part of your app now I still would have a an option in the overflow menu to go and apply the upgrade for people who know they really want to get to it to keep them having to dig but you definitely look at other opportunities for upselling right trying to figure out you know how users will know that there's actually additional value that is something they want to buy yep thank you question anybody else all right we'll move on to the next question a moderator is that okay yeah so the producer says okay I'm living several images from disk at basically the same time using a background thread of course however loading so many images in a matter of milliseconds will cause GC for alloc causing noticeable Jing anything they can do about that oh it sounds like couple famous question Jeff John take a shot at this sure so it's something to realize is even in that background thread if you're making that allocation you're allocating those bitmaps if you do end up having to do this GC for alloc it'll it could potentially end up blocking in the main thread of your application that's running the the UI the animation um if that main thread is also trying to allocate things so really what you're looking to do here is you want to really optimize and minimize the number of allocations you're doing on that main thread because where you might find in this case is there's one small little allocation that's being exposed to this pause from the background thread if you're able to get the UI animation done with zero allocations if you're get it all the way down to zero um you probably wouldn't see that pause that you're describing yeah also I'll add that I did a code lab at Google i/o that did something very similar to the behavior you're describing and specifically we I created a grid view that loads a bunch of really high resolution images over and over again and we sort of walk people through going and finding all the the hotspots in the code all the things that would cause a garbage collection cause you're just general jank everything that was bad and we'd go and take get rid of them one after the other and I think that you can get a link to it from the Google i/o website if not it is on my own website T John's net slash il 2012 I have all the code up there yeah important things make sure you know of course for performance reasons you're gonna want to load your your images in the background thread use async task or something similar also make sure that you're reusing all of your you know your ListView element your year yeah little is it item use I think the word make sure you will use those they do get recycled and just make sure that you reuse object whenever possible on that note make sure that your recycling bitmaps to write all the usual things for whenever you're dealing with with bitmaps apply there because there they do take up a lot of memory and it's very easy to mess up and cause calls objects we created when they don't need to be and we've added a lot of hooks there especially like I said that you can recycle bitmaps and you know hang on to things that way actually recycling a bitmap actually gets rid of it right Turner what the right way to do it is by the view and what the right way to handle bitmaps like we use the the address space there for it I'm trying to remember it I because there is like a release method or a recycle right but I don't think that's what recycling actually completely gets rid of it but there is a method where you can pass it in an existing instance into a bitmap options as part of the inflate and that's one of the that's the mechanism that you're describing that would allow you to recycle those existing allocations right via the the biggest takeaway though is avoid allocations inside of your drawing on your own draws because that's what's it's probably exposing in this case onto that jank yep and you can take a look in DDMS there is an allocation track that will show you all of your memories going and that should give you a pretty strong clue as to what's causing all these GC events all right I actually have a question from someone on the on the invite Simon Markey who wants to know what is the best choice to play a list of music files for an app and sometimes interrupts them to play in effect sound and he's listed a couple of ideas and and also what is the you know is there a best practice to probably handle the sound like when the screen is off and so on and so forth so I'm going to jump in and answer that as well so yes sound pool is the API that you want to look for to best handled that sort of thing so you know a variety of different sound effects and music within within a game sound Paul is definitely a friend and the media player API should you need it but I think you should actually be able to handle most things within sample by itself in terms of the best way to handle sound playing our good friends from the Friday review in Lewis and Dan Galpin actually covered this in some detail at their Google i/o talk ten things all game developers should know so check that out and that will give you some great advice particularly how to handle things like music playback during the lockscreen and when the screens off and those sorts of things great answer thank you thank you very much next question from moderator in the developers console for one app the content rating has the everyone rating disabled and next to it it says this rating option has been disabled by the Google Play team what could have caused this well the answer is actually like that in front of your face it was manually set by a member of the Google Play team so they we do periodically review apps and if we notice that an app has an incorrect lating its lated lower than it should be we'll go and make a manual adjustment and that's what you're seeing there so basically they're saying your app contains some sort of content that it makes it unsuitable for everyone and yeah in my experience the most common cause for that is typically if you're using some sort of dual requesting file location in your app as a permission then there is a minimum level maturity level which it has to be I think it's not the lowest possibly the next up from that at least so that tends to be the most common case it can also be if there is you know if your apps being flagged and the Play team are looking through to it to make sure that it's compliant with our content policies and so on and they do it manually for those reasons as well but location I think is typically the most common case for this sort of thing that's good to know okay great uh next question from moderator when using an MHL adapter to get HDMI out some apps like YouTube show different views on the device display and the HDMI output how's that done I could not find any API for this is it Hardware dependent so I did some digging into this and the answer is there isn't really an API this is something that's done by the system whenever at least the the Google Experience devices detect a video surface they'll modify the HDMI output to go and display the contents of only that video surface so it's not something that YouTube is explicitly doing it's something the system is taken care of automatically now that said this behavior is not guaranteed for all devices it's a vendor specific implementation detail so other devices might use to handle HDMI differently but you know to answer your question though if you want to go and display some custom content on the other display there's not really a way to do it right now it's just limited to videos okay thank you I have two questions from the from the live invite one is by gosh that's a name which is gonna be hard for me to jazz leg bunker who would like to know the name of the guy in the Hat oh hey my name is Trevor John's oh I'm actually on here almost every week usually without a hat but yeah I'm I'm on the same team as Joe and Ray they were all members of the Android developer relations team so yeah we are we we are sort of trying to implement possibly having a mandatory hat wearing person in each of our sessions that's usually Dan Galpin on Friday but seeing as Dan doesn't sit in on these sessions we thought we'd see that I Trevor can support a hat with the style to which we've become accustomed yeah the next question is from Nicholas Johnson and he's attempting to develop a rich text component with buttons the typical rich text editing and he goes on to say that spans make really difficult to work with the whole thing is kind of a pain particularly when you get to things like Texas election so my my suggestion here I'll be interested to see if you guys agree but uh attempting to develop a rich text editing component within Android is not going to be simple you're effectively gonna have to recreate the edit text component from scratch because as soon as you're trying to do things like change colors mid line add italics and bold and so on and so forth to arbitrary text within a full control then you really need to also take care of how that layout is going to work so you're effectively going to end up having to recreate the edit text component from scratch into something which within a fairly short amount of time is going to look a lot like a web browser which is in fact how a lot of teams have have implemented this sort of thing so where they do have the need for rich text editing rather than being something a variation of the edit text it's actually a webview within within the app so that I don't know my gut feeling is that that's kind of gonna be the way to go if you want to have something like anything beyond sort of really simple markup how do you guys feel yeah I think that that pretty much covers it rich text is definitely that's very difficult to implement and webview covers most of it already it covers more than you probably want so because you're looking for expansion and honestly most of the time when people are doing rich text anyway they're gonna go and want to convert it to HTML so using a webview takes care of that for you as well okay thank you next question from moderator I've noticed that some apps that use action bar tabs for navigation will have the tabs replaced with the drop-down list one switch to landscape well there isn't enough room for tabs is there a way to force it to do that landscape tags are ugly okay I think the simple answer for me is to try and use an action bar where possible because that's gonna already have that sort of toggle between you know a navigation in so it's gonna be a drop down navigation in portrait mode and sort of in action bar tabs potentially in in landscape mode so you can sort of do that variation yourself it doesn't necessarily help you for if you want to have apps which work prior to honeycomb mind you but you can certainly try and use that same sort of model in general my feeling is that your your tab host control isn't great but I mean this is talking about action bar tabs in general so yeah okay so it's specific to action bar tab so that would be my suggestion is to just switch between them using the the the spinner in portrait and there and the tabs in in landscape versa all right thank you very much next question got a hangout question shoot a club I created a test database and expert exported the strings to insert test data looping through a string array and we're all executing each command to populate the database put it I couldn't use begin to transaction because I was already in one any advice for creating a test database on a device so you were already in a transaction so just to I I don't know if they're running this so it's an Android program it's an Android app and they're attempting to build a pre-populated database is that that's what it sounds like um so that you should be able to create everything inside of a single transaction on your own I'm not sure with the exact I it shouldn't be creating a transaction on your behalf you should be able to begin and manage your own but yeah with without any more detail the the other thing he was mentioning is that it's designed to be generated once so he's pre generating a sequel like database to then ship we're getting some clear okay it was in the on Crete in the open helper okay you should be able to i/o so if it's in the oncreate you yeah you're right you may already be in a transaction at that point on so if you're looking to test performance it should be as as good as it's going to get on the one of the thing to potentially look at is when you're doing that initial database setup I mean you're inserting a lot of data in a bulk way you may look at I creating your indexes after you've inserted all of the data if you create the indexes and then do a whole bunch of inserts on the database is going to may try updating those indexes as you're inserting all of your data but if you insert the data first and then create the indexes you may end up with less work on the database engine side of things so it may be faster okay any response from them he said thanks okay well I don't got any more questions yeah just holler out otherwise we'll move on to the next question and moderator um I have to load an image with certain restrictions for example I have an 8 megapixel picture that I want to send a crop as a square rotate and maybe scale it what's the most efficient way to do this without creating new bitmaps and recycling the old one all right that's so that's actually a pretty good question yeah Jeff you don't have an answer off the top of your head for that um so I think it depends on your zoom mean if the user can zoom in on the the photo and while they're actually working on it because there are some eyes so the 8 megapixel that's a lot of data behind the scenes so there's a handful of bitmapfactory the bitmap options you can actually request to have it down sampled so you can request it to maybe only load every other pixel so instead of a an 8 megapixel photo now you're working with a 4 megapixel so there's some options there that you can load a lower resolution version of the photo for the user to edit it may not be the full quality that they're expecting on the VB lower resolution once you've decided the mutation operations that the user wants to perform once they've chosen like the exact rotation you can go back and perform a high-quality pass of those operations on the full resolution photo so that may allow you to make your UI nice and fast you're maybe rotating and manipulating something lower quality but then applying it as a planet later against the full resolution image that seems like it will be a fairly good approach for what they're describing here because it's it's fairly coarse grained stuff so sent to crops where it rotate so it sounds like they just basically want to be able to load up any picture and in the same way that you choose like a profile pic or something in a social network you just needed to be square so you just pick it I think in that instance particularly on an Android app you know even if you are zooming in as long as it's sort of good enough to see what the what the edges are you can do that and then do like a live preview of the crop data at a higher res maybe yeah and yeah bitmap factory has methods to do most of that stuff the only one I'm not clear about is rotation I'm not sure if you can have it rotate for you if that's the case you might even want to consider sub-classing but not factory and adding rotation in there so that way all these operations are performed as you're loading the bitmap and that that would help reduce than that yeah if you can do before you create your bitmap then you only have to click one bitmap yeah the benefit of using those those options is that skia down deep in the native code is the one that's doing this down sampling so your your application doesn't have to allocate 8 megapixels worth of data to store the data all right to store the image when it's inflated I'm so it's doing it in a very optimized way under the hood ok thank you next question from moderator could you consider maintaining the Android and support library artifacts officially in maven central whoever does it now can be a bit slow and it is a pain in the ass one of a better word so yeah future cost notice we've always had a bit of reluctance to go and support any build systems aside from eclipse just because that's what we decided that we wanted to go and spend our time supporting and we've always left everything else to the community to do I'll definitely pass that along to the build team and let the digital team rather and let them know there's a feature request for that that being said I'm pretty sure they've heard it before it's not the first time I've seen this come up but you know most likely it's gonna be a bit of a tough sell because we have we have chosen to go and focus most of our efforts on the clips but again I'll make sure they get that feedback related to that as well I mean we we sit right next to the tools team so if you guys have like questions or requests or something like that you'd like to see us do a hangout or something like this specifically so you guys can talk to them let us know and we will schedule something up so yeah that is a resource available we're not part of that team so we aren't necessarily but yeah the best position to answer those sorts of questions all right we're getting towards the end so let's move on through as quickly as we can did the Nexus S have it's offline voice dictation and hot work detection disabled in 4.1.1 due to inadequate audio hardware if so what are your guidelines for testing if device is for running for that one to meet the baseline for using the relevant new multimedia ap is I don't think anybody knows the answer to that given that none of us work on the voiced V for the voice team so this is probably a question better suited for another office hours we might have somebody from the worst team on but like now we have no expert to can actually give you a definitive answer there yeah go for it it's about location updates in a service is it better battery wise to sample updates from network or passive providers on an interval or register on start a listener or pending intent and depend on the request updates parameters for a min time and man distance okay so let me see if I understand this so the question is are they better off polling so basically getting a lot get last-known location or using a we're basically asking for location-based updates at a minimum time and distance is that the gist yeah so when I remember guest la get last position is literally returning the last known position which is not gonna be where the user is that necessarily at that given moment so that is one issue you have to deal with but I would say Jen I mean in terms of terms of efficiency hmm so in terms of efficiency I would almost never recommend a poling approach they just it as soon as you're polling for anything then you'll be creating a minimum amount of time where the device is going to be on responding to whatever it is that you're doing at that wake up so if you can have anything which is more on-demand that tends to be a better solution so I I would yeah I would definitely go with actually creating a location listener particularly for passive provider that way if there are no apps requesting location updates then your app will never get triggered so it will go to sleep and so this is really important when the device is on standby so if you are doing a polling solution then you're still going to wake the device and you're still going to check to see when what that last location update was even if it hasn't changed for an hour whereas you actually got a listener registered it's no less efficient than polling in terms of the work it's doing and you had the advantage of being on demand so that you know it's only gonna happen as frequently as any other app is actually making those location requests okay thank you um this is an interesting one can you take another look at my question from last week ran out of time at the end question is how to iterate through fragments in a tabbed view pager to tell each fragment the paint data which has been updated by a loader in the main activity I might be hearing that question last week following their production I don't I don't think we had a great answer then and I'm not sure that there really is one yeah I I still my question is why are you trying to do this given that you're only gonna have one one page on your view pager visible and trying to ask anything else to update else in the background it's just a waste of CPU most of the most UI events don't occur for objects which are which are off screen now that being said you know the question area that the answer here is yeah basically your typical solution for communicating with five minutes I don't think if you I don't think viewpager really has anything to do with it it's really a matter of just going and sending a method to all of your five banks so it'll register some sort of callback method so that your your activity can just go and and deliver a message to all the known fragments when these events happen and let them know that they have stale data which needs to be refreshed at some point which is appropriate and that's kind of so data set observer is one way that list views for example connect up to cursors so when you assign a cursor to a cursor loader and it's bound to a list view that that list view may be often one of those other fragments on but the data set observer is the mechanism by which it knows I need to invalidate and repaint my content so a strategy like that there's data side observer and data side observable there's me there's me be good at strategy okay oh we got don't hang out question in two more minutes all right but hang out question last one here this person has quite a big database of assets and dumps it into an SD card is there a way to access this database directly to assets so I don't have to duplicate it since it's like six megabytes does that make sense yes I think what he wants to do here is basically similar to the question which one of the earlier question is had which is I want a pre-populated database but I don't you know I don't want to download it you know piecemeal I just want to be able to dump it on an SD card possibly as part of the installation process or as a one-off and right now you would have to do all the usual ways that you would then have to open that database move everything into an SQLite database and have the content provider on top of that to do most operations so I think the question here is is there a way you can just point to that database and say this is my database treated the same way you would an SQLite database that you had opened so I'm not sure I'm not sure that I have an answer I think if it is an SQLite database then you probably can if it's not and I'm not sure that that's I think do you guys have any so single life databases I think you can open based on an explicit file system path we could tell it opens file but what thing one thing to note is that I if it's living out on the SD card on anyone could come along open it right a bowl and write all any sort of data in there which then your app is gonna go consume so anything on the SD card is is publicly available for other apps to write into the other thing is if you're using it for persistence just be aware that sometimes that you know the SD card it can disappear on but it may also not be on the SD card can be of varying quality because they're using a different file system that's maybe not as resilient if you're using the internal file system on the device and maybe it's like yaps or ext4 it's a lot more resilient to like changes if the user pulls the battery out of their device yeah I think that I really just want to emphasize that that first point which is that it's trivially easy for your SD card to be or your shared shared space to be unmounted and if someone plugs it into their computer boom your database disappears if they unclick their SD card boom your database is gone and so that adds a certain amount of mmm how can I say it doesn't do bad things it doesn't do good things into your app so suddenly you have to keep in mind the fact that your database may just disappear mid transaction and figure out how you're gonna recover from that and as well as Jeff said it can change so it can be mounted to a computer then have all of its data changed and then plug back in and you need to figure out what you're gonna do with that now so it's generally not generally not great practice to go that way granted if you've got a very large database it seems like a reasonable alternative but you may actually want to consider storing and keeping most of that on a server and just downloading effectively enough data to have cached a reasonable amount of data to be able to respond to when you're offline rather than storing the entire thing on on the phone depending on your usage mama may know that may not work okay uh-huh so I think with us that's it for time I think we have run off the end of the clock so once again thank you everybody for stopping in and we will see you next week thanks everyone		